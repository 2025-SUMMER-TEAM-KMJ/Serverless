name: Scrape Wanted Company Profile

on:
  schedule:
    - cron: '0 0 * * *'  # 매일 자정에 실행
  workflow_dispatch:
    inputs:
      mode:
        description: '스크래퍼 실행 모드'
        required: true
        default: 'create'
      max_companies:
        description: '최대 회사 수'
        required: true
        default: '500'

jobs:
  scrape:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install scrapy pymongo python-dotenv jsonschema

      - name: Run Scraper
        env:
          MONGO_URI: ${{ secrets.MONGO_URI }}
          MONGO_DATABASE: ${{ secrets.MONGO_DATABASE }}
        run: cd wanted_company_profile && scrapy crawl wanted_company_profiles -a mode=${{ github.event.inputs.mode || vars.COMPANY_PROFILE_MODE || 'create'}} -a max_companies=${{ github.event.inputs.max_companies || vars.COMPANY_PROFILE_MAX_COMPANIES || 500}}
